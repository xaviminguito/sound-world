---
import Layout from '../../layouts/Layout.astro'
import PlayButton from '../../components/PlayButton'
import Record from '../../components/Record'
import {getAlbums} from "../../ui/api/getAlbums";

const { id } = Astro.params

let albumsSupabase = await getAlbums()

const currentAlbum = albumsSupabase.find(result => result.user_id == id);
const albums = albumsSupabase.filter(album => album.user_id == id);

---

<Layout title={`${currentAlbum.title} by ${currentAlbum.artist_name} - Astro Records`}>
  <section aria-labelledby="page-heading">
    <div
      class="container mx-auto max-w-screen-lg px-6 lg:px-0 flex flex-col items-start pt-8 pb-12 gap-10"
    >
      {
        albums.map((album) => (
        <div class="flex gap-5 items-center">
          <Record
            client:visible
            artist_name={album.artist_name}
            id={album.id}
            title={album.title}
            cover_url={album.cover_url}
          />
          <div class="flex-1 flex flex-col justify-end pt-8">
            <div id="page-heading">
              <h1 class="flex flex-col">
                <span id="collection" class="text-5xl font-bold tracking-tight text-gray-900" translate="no">{
                  album.title}
                </span>
                <span class="mt-3 text-3xl" translate="no">{album.artist_name}</span>
              </h1>
            </div>
            <div class="mt-2 text-lg" translate="no">{album.genre} â€” {album.year_released}</div>
            <div class="mt-3 flex">
              <PlayButton
                track={album.track}
                id={album.id}
                title={album.title}
                artist_name={album.artist_name}
                cover_url={album.cover_url}
                data-year={album.year_released}
                client:load
              />
            </div>
          </div>
        </div>
        ))
      }
    </div>
  </section>
</Layout>
